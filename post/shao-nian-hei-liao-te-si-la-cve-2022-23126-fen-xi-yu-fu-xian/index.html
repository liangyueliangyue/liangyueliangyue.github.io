<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>少年黑了特斯拉？CVE-2022-23126分析与复现 | 6right</title>

<link rel="shortcut icon" href="https://liangyueliangyue.github.io/favicon.ico?v=1686021349967">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://liangyueliangyue.github.io/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages//dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            6right
        </div>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" id="changeNavbar">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/archives" class="menu gt-a-link">
                    归档
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/tags" class="menu gt-a-link">
                    标签
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/about" class="menu gt-a-link">
                    关于
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/friends" class="menu gt-a-link">
                    友链
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1686021349967"
                action="/search/">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = () => {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    少年黑了特斯拉？CVE-2022-23126分析与复现
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2022-06-07 ·
                    </time>
                    
                        <a href="https://liangyueliangyue.github.io/tag/Z5a4xaOEm/" class="post-tags">
                            # 物联网
                        </a>
                    
                        <a href="https://liangyueliangyue.github.io/tag/pe3-Tsqw7/" class="post-tags">
                            # 漏洞分析
                        </a>
                    
                        <a href="https://liangyueliangyue.github.io/tag/u6omW3BTp/" class="post-tags">
                            # 渗透测试
                        </a>
                    
                </div>
                <div class="post-content">
                    <h1 id="cve-2022-23126">CVE-2022-23126</h1>
<h2 id="首发于火线zonehttpszonehuoxiancnd1235-cve-2022-23126">首发于火线Zone：https://zone.huoxian.cn/d/1235-cve-2022-23126</h2>
<p>详情：https://medium.com/@david_colombo/how-i-got-access-to-25-teslas-around-the-world-by-accident-and-curiosity-8b9ef040a028</p>
<p>2022年1月份，年轻黑客宣称远程控制了25 辆特斯拉</p>
<figure data-type="image" tabindex="1"><img src="https://6right-images.oss-cn-hangzhou.aliyuncs.com/images/202206011133032.png" alt="image-20220601112352008" loading="lazy"></figure>
<p>其实就是这个cve的来源，而真正的漏洞来自于https://github.com/adriankumpf/teslamate暴露在外网端口上</p>
<p>teslamate是Tesla 的功能强大的自托管数据记录器</p>
<p>特点：</p>
<ul>
<li>通过Elixir编写</li>
<li>数据存储在<strong>Postgres</strong>数据库中</li>
<li><strong>使用Grafana</strong>进行可视化和数据分析</li>
<li>车辆数据发布到本地<strong>MQTT</strong> Broker</li>
</ul>
<p><strong>先从作者的文章来看看这个漏洞的细节</strong></p>
<h2 id="信息泄露">信息泄露</h2>
<p>访问dockerfile默认暴露的4000端口可以得到特斯拉地址信息</p>
<figure data-type="image" tabindex="2"><img src="https://6right-images.oss-cn-hangzhou.aliyuncs.com/images/202206011133034.png" alt="image-20220531114258685" loading="lazy"></figure>
<p>但因为使用了grafana，如果开启了匿名访问（即免登陆访问），且3000端口也暴露在公网，那么grafana就会泄露大量数据如：特斯拉去过的地方，充电的地方，当前位置，通常停放的地方，驾驶时间，旅行速度，导航请求，软件更新历史，甚至特斯拉周围的天气历史等等多得多。</p>
<h3 id="grafana">Grafana</h3>
<p>Grafana 是一个监控仪表系统，它是由 Grafana Labs 公司开源的的一个系统监测 (System Monitoring) 工具。它可以大大帮助你简化监控的复杂度，你只需要提供你需要监控的数据，它就可以帮你生成各种可视化仪表。同时它还有报警功能，可以在系统出现问题时通知你。</p>
<h3 id="修复措施">修复措施</h3>
<p>也就是将默认开启的匿名访问关闭</p>
<figure data-type="image" tabindex="3"><img src="https://6right-images.oss-cn-hangzhou.aliyuncs.com/images/202206011133035.png" alt="image-20220531114440349" loading="lazy"></figure>
<h2 id="进一步获取tesla-用户api-密钥">进一步获取Tesla 用户API 密钥</h2>
<p>grafana确实保存了 API 密钥，它还存储了所有其他数据。API 密钥既不单独存储也不加密。但需要<a href="https://grafana.com/docs/grafana/latest/explore/">Grafana Explore</a>来运行自定义查询。这需要身份验证（经过测试，匿名访问不需要身份验证）。</p>
<p>然后就是利用默认密码（admin/admin）/弱口令来进行身份验证，然后得到查询权限</p>
<p><strong>如何访问世界各地的随机特斯拉</strong></p>
<ul>
<li>在互联网范围内搜索 TeslaMate 实例（例如搜索 MQTT 代理）。</li>
<li>确保它们使用不安全的默认 Docker 配置运行（这应该现在已经修复，因为用户请尽快拉取最新版本）。</li>
<li>转到端口 3000 以访问 Grafana 仪表板。</li>
<li>使用默认凭据登录*（当然只有在明确授权的情况下才能这样做）*。</li>
<li>转到资源管理器选项卡。</li>
<li>使用查询生成器提取 API 并刷新令牌。</li>
<li>玩特斯拉（当然仅限于您拥有的车辆），玩得开心。</li>
</ul>
<p><strong>使用 Tesla API 令牌可以做的事情包括但不限于：</strong></p>
<ul>
<li>解锁车门。</li>
<li>打开窗户。</li>
<li>开始无钥匙驾驶。</li>
<li>与特斯拉分享视频。</li>
<li>更改加热器/冷却器设置。</li>
<li>按喇叭和闪烁的灯光。</li>
</ul>
<p>最终结果是特斯拉撤销了数千个密钥，所以这可能是一个更普遍的问题。</p>
<h2 id="实例复现">实例复现</h2>
<p>互联网一个实例（外国）</p>
<h3 id="获取tesla-key">获取tesla key</h3>
<p>4000端口默认开放,访问可以得到地理位置等一些信息</p>
<figure data-type="image" tabindex="4"><img src="https://6right-images.oss-cn-hangzhou.aliyuncs.com/images/202206011133036.png" alt="image-20220601094922516" loading="lazy"></figure>
<p>访问3000，开启了匿名访问</p>
<figure data-type="image" tabindex="5"><img src="https://6right-images.oss-cn-hangzhou.aliyuncs.com/images/202206011133037.png" alt="image-20220601095016606" loading="lazy"></figure>
<p>那么可以直接得到更多tesla信息</p>
<figure data-type="image" tabindex="6"><img src="https://6right-images.oss-cn-hangzhou.aliyuncs.com/images/202206011500285.png" alt="image-20220601115841188" loading="lazy"></figure>
<p>然后访问explorer数据库查询接口通过sql语句查询获取key</p>
<pre><code>curl http://xxxx:3000/api/tsdb/query
{&quot;queries&quot;:[{&quot;refId&quot;:&quot;A&quot;,&quot;intervalMs&quot;:60000,&quot;maxDataPoints&quot;:1843,&quot;datasourceId&quot;:1,&quot;rawSql&quot;:&quot;SELECT\n  id AS \&quot;time\&quot;,\n  *\nFROM tokens\nORDER BY 1&quot;,&quot;format&quot;:&quot;table&quot;}]}
</code></pre>
<p>如果，没开启匿名访问，需要尝试默认密码或者弱口令，成功登录后一样获取信息或者使用explorer进行查询key</p>
<figure data-type="image" tabindex="7"><img src="https://6right-images.oss-cn-hangzhou.aliyuncs.com/images/202206011133038.png" alt="image-20220531175620101" loading="lazy"></figure>
<p>得到数据库中的Tesla key</p>
<pre><code>access:
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</code></pre>
<p>前面加bearer (也就是jwt)然后访问Tesla官方api接口</p>
<ul>
<li>https://www.teslaapi.io/</li>
</ul>
<h3 id="获取车辆列表">获取车辆列表</h3>
<ul>
<li>https://owner-api.teslamotors.com/api/1/vehicles</li>
</ul>
<figure data-type="image" tabindex="8"><img src="https://6right-images.oss-cn-hangzhou.aliyuncs.com/images/202206011133039.png" alt="image-20220601095440115" loading="lazy"></figure>
<p>得到车辆id（注意这里是id不是vehicles_id）</p>
<h3 id="再获取车辆信息">再获取车辆信息</h3>
<ul>
<li>https://owner-api.teslamotors.com/api/1/vehicles/xxxx/vehicle_data</li>
</ul>
<figure data-type="image" tabindex="9"><img src="https://6right-images.oss-cn-hangzhou.aliyuncs.com/images/202206011133040.png" alt="image-20220601095827362" loading="lazy"></figure>
<p>官方还提供了对车的种种操作比原文作者说的更多</p>
<figure data-type="image" tabindex="10"><img src="https://6right-images.oss-cn-hangzhou.aliyuncs.com/images/202206011133041.png" alt="image-20220601095900208" loading="lazy"></figure>
<p>这里未授权就不进行深入尝试了</p>
<h2 id="后记">后记</h2>
<p>复现下来，这是一个tesla的开源项目的漏洞和tesla本身并没有什么联系，漏洞利用难度也很低，只是web应用层的简单利用，但是影响也不小。即使在现在互联网上还是有很多存在漏洞的实例。</p>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://liangyueliangyue.github.io/post/mqtt-xie-yi-che-lian-wang-ying-yong-andyuan-ma-fen-xi-yi/" class="post-title gt-a-link">
                    MQTT协议-车联网应用&amp;&amp;源码分析（一）
                </a>
            </div>
        

        
            <span id="/post/shao-nian-hei-liao-te-si-la-cve-2022-23126-fen-xi-yu-fu-xian/" class="leancloud_visitors" data-flag-title="少年黑了特斯拉？CVE-2022-23126分析与复现">
                <em class="post-meta-item-text">阅读量 </em>
                <i class="leancloud-visitors-count">0</i>
            </span>
        

        

        
            <script src='https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js'></script>

<style>
	div#vcomments{
		width:100%;
		max-width: 1000px;
		padding: 2.5%
	}
</style>


	<div id="vcomments"></div>

<script>
	new Valine({
		el: '#vcomments',
		appId: 'QR1YL8ep02tLdNVejam0Whhv-gzGzoHsz',
		appKey: 'I37Ekl4E78WEw4EpQ5WRlzxL',
		avatar: 'monsterid',
		pageSize: 5,
		recordIp: false,
		placeholder: '留下你的评论！',
		visitor: true,
	});
</script>

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">温润如玉</div>
    <div class="social-container">
        
            
                <a href="https://github.com/liangyueliangyue" target="_blank">
                    <i class="fab fa-github gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
    <div>
        Theme <a href="https://github.com/imhanjie/gridea-theme-pure" target="_blank">Pure</a>, Powered by <a
                href="https://gridea.dev" target="_blank">Gridea</a> | <a href="https://liangyueliangyue.github.io/atom.xml" target="_blank">RSS</a>
    </div>
</div>

<script>
  hljs.highlightAll()
</script>

    </div>
</div>
</body>
</html>
